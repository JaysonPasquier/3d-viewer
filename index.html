<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>baby-foot-M8</title>
    <link rel="icon" href="data:,">
    <style>
      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #000;
        height: 100%;
      }
      canvas { display: block; }
      .loading {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #0ff;
        font-family: sans-serif;
        letter-spacing: 1px;
      }
    </style>
  </head>
  <body>
    <div class="loading" id="loading">Loading 3D Scene...</div>

    <!-- âœ… All imports from full URLs -->
    <script type="module">
      import * as THREE from 'https://unpkg.com/three@0.164.0/build/three.module.js';
      import { OrbitControls } from 'https://unpkg.com/three@0.164.0/examples/jsm/controls/OrbitControls.js';
      import { GLTFLoader } from 'https://unpkg.com/three@0.164.0/examples/jsm/loaders/GLTFLoader.js';
      import { RGBELoader } from 'https://unpkg.com/three@0.164.0/examples/jsm/loaders/RGBELoader.js';
      import { EffectComposer } from 'https://unpkg.com/three@0.164.0/examples/jsm/postprocessing/EffectComposer.js';
      import { RenderPass } from 'https://unpkg.com/three@0.164.0/examples/jsm/postprocessing/RenderPass.js';
      import { UnrealBloomPass } from 'https://unpkg.com/three@0.164.0/examples/jsm/postprocessing/UnrealBloomPass.js';

      // Setup scene, camera, renderer
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(65, innerWidth / innerHeight, 0.1, 100);
      camera.position.set(0, 1.5, 4);

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(innerWidth, innerHeight);
      renderer.outputColorSpace = THREE.SRGBColorSpace;
      renderer.toneMapping = THREE.ACESFilmicToneMapping;
      renderer.toneMappingExposure = 1.5;
      document.body.appendChild(renderer.domElement);

      // Orbit camera controls
      const controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      controls.target.set(0, 1, 0);

      // Lighting
      scene.add(new THREE.AmbientLight(0xffffff, 0.3));
      const dirLight = new THREE.DirectionalLight(0xffffff, 2);
      dirLight.position.set(2, 4, 2);
      scene.add(dirLight);

      // HDRI environment
      new RGBELoader().load('https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/studio_small_03_1k.hdr', (hdr) => {
        hdr.mapping = THREE.EquirectangularReflectionMapping;
        scene.environment = hdr;
      });

      // Bloom postprocessing
      const composer = new EffectComposer(renderer);
      const renderPass = new RenderPass(scene, camera);
      composer.addPass(renderPass);
      const bloomPass = new UnrealBloomPass(new THREE.Vector2(innerWidth, innerHeight), 1.2, 0.4, 0.85);
      bloomPass.strength = 1.6;
      composer.addPass(bloomPass);

      // Load your GLB from Google Drive (direct link!)
      const loader = new GLTFLoader();
      const driveURL = 'https://drive.google.com/uc?export=download&id=1gmE0mXhHi4DWBQqRFxCVYFK5EWss1Ld3';

      loader.load(
        driveURL,
        (gltf) => {
          const model = gltf.scene;
          scene.add(model);
          document.getElementById('loading').remove();

          // Add glow for emissive parts
          model.traverse((child) => {
            if (child.isMesh && child.material) {
              if (child.material.emissive) {
                child.material.emissiveIntensity = 4.0;
              }
            }
          });

          // Handle animations
          const mixer = new THREE.AnimationMixer(model);
          gltf.animations.forEach((clip) => mixer.clipAction(clip).play());
          const clock = new THREE.Clock();

          // Animation loop
          function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            mixer.update(delta);
            controls.update();
            composer.render();
          }
          animate();
        },
        (xhr) => {
          const percent = Math.round((xhr.loaded / xhr.total) * 100);
          document.getElementById('loading').textContent = `Loading... ${percent}%`;
        },
        (error) => {
          document.getElementById('loading').textContent = 'Error loading model';
          console.error('Error:', error);
        }
      );

      // Responsive resizing
      window.addEventListener('resize', () => {
        camera.aspect = innerWidth / innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(innerWidth, innerHeight);
        composer.setSize(innerWidth, innerHeight);
      });
    </script>
  </body>
</html>
